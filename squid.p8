pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
	make_player()
	make_npc()
	draw_player()
	draw_map()
end

function _update()
	move_player()
	npc_movement()
end

function _draw()
	draw_map()
	draw_player()
	draw_npc()
	

end
-->8
function make_player()
player = {}
player.x =112
player.y =112
player.dx =0
player.dy =0
player.sprite =2

end

function move_player()
	//print(collisions(player.x, player.y))


	if(btn(0) and not collisionl(player.x, player.y)) then
		player.x -=1
	end
	
	if(btn(1) and not collisionr(player.x,player.y)) then
		player.x +=1
	end
	
	if(btn(2) and not collisiont(player.x,player.y)) then
		player.y -=1
	end
	
	if(btn(3) and not collisionb(player.x,player.y)) then
		player.y += 1
	end
end

function draw_player()

	spr(player.sprite, player.x, player.y)

end

function draw_map()
	map(0,0,0,0,127,127)

end

function collisionl(posx, posy)
	
	local lceltop = false
	local lcelbot = false

	if(posx % 8 == 0) then
	 lceltop =fget(mget((posx/8)-1, (posy-posy%8)/8), 0)	
	 lcelbot =fget(mget((posx/8)-1, (posy+8-posy%8)/8), 0)
	end
	
	if(posy%8 == 0) then
		lcelbot = false
	end
	
	return lceltop or lcelbot
end

function collisionr(posx, posy)
	
	
	local rceltop = false
 local rcelbot = false
 
	if(posx % 8 == 0) then
	 rceltop =fget(mget((posx/8)+1, (posy-posy%8)/8), 0)
	 rcelbot =fget(mget((posx/8)+1, (posy+8-posy%8)/8), 0)
	end
	
	if(posy%8 == 0) then
		rcelbot = false
	end
	
	return rceltop or rcelbot
end

function collisiont(posx, posy)
	
	local tcellef = false
	local tcelrig = false

	
	if(posy % 8 == 0) then
		tcellef =fget(mget(((posx-posx%8)/8),(posy/8)-1),0)
		tcelrig =fget(mget(((posx+8-posx%8)/8),(posy/8)-1),0)
	end
	
	if(posx%8 == 0) then
		tcelrig = false
	end
	
	return tcellef or tcelrig
end

function collisionb(posx, posy)
	
	local bcellef = false
	local bcelrig = false
	
	if(posy % 8 == 0) then
	bcellef =fget(mget(((posx-posx%8)/8),(posy/8)+1),0)
	bcelrig =fget(mget(((posx+8-posx%8)/8),(posy/8)+1),0)
	end
	
	if(posx%8 == 0) then
		bcelrig = false
	end
	
	return bcellef or bcelrig
end

function make_npc()
npc={}
npc.x = 15
npc.y = 7
npc.dx = 0 
npc.sprite = 10
npc.timer = 30
npc.movecount = 0
npc.upmask = 0

end


function npc_movement()
	if (npc.timer == 1) then
		npc.timer = 30
	else
		if (npc.upmask == 0) then
			if (npc.timer%5 == 0) then
				npc.y += 1
				npc.movecount +=1
				npc.timer -=1
				if (npc.movecount == 8) then
					npc.upmask = 1
				end
			else
				npc.timer -=1	
			end
		else
			if (npc.timer%5 ==0) then
				npc.y -= 1
				npc.movecount -= 1
				npc.timer -=1
				if (npc.movecount == 0) then
					npc.upmask = 0
			 end
			else
				npc.timer -=1 		
			end
		end
	end
end			

function draw_npc()
spr(npc.sprite, npc.x, npc.y)
end
__gfx__
00000000111111110000000011111111222222222ff7f22222ff2222222fff22222222222222222200000000222222222222222222222222222222222ff7f222
000000001111cc11000cc00011111111222222222f7ff22222ff22222222fff22222222222222222000880002ff222222f62222222ffff22222222222ffff6f2
00700700111ccc1100cccc0011111111ff22222222ffff2f222ff222222ff7f2222222ffff22222200888800222f7ff2226fff222fffcff22222fff222ff6ff2
00077000111c1cc1007cc70011111111ffffffff2222ffff222ff222ffff7f2222222f7ffef222220078870022ff67f222ffffe2ff6feff222fffff222ffff22
0007700011cc11c10c0cc0c01111111122ffffff22222fff222ff222ff7ff2222222fff2ffff22220808808022f7cf2222fefff2ffeffff222fcff2222f6f222
0070070011c111c10cccccc01111111122ff2222222222ff222ff22222f222222222f7f22f7622220888888022f7f22222fffff22fffff222ffef222222fef22
0000000011ccccc100c00c0011111111222222222222222222ff2222222222222222ff222f6ff2220080080022ff2222222fff22222222222fcff2222222ff22
000000001111111100c00c001111111122222222222222222ff7f22222222222222f7f222ffff222008008002222222222222ff22222222222ff222222222222
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
222222ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
fff22f7f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
f77ffff2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2ffff7f2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
222fff22000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
222f7f22000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001000001010101010100010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0804040404040404100404040404040903030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0603030303030303060303030301010603030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0603030103030303060301030301030603030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0603030303010303050409030303030603030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06030103030303030303050d0303030603030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0603030303030301030303030303030f03030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040903030303030308040903030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0c0c0504090303080407080703030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c0b080404070303050404070303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0804070303030303030303030303030e03030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0603030303030303030303030303030603030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0603030303030303030303030303030603030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0603030303030303030303030303030603030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0603030303030303030303030303030603030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0603030303030303030303030303030603030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040404040404040404040404040703030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
